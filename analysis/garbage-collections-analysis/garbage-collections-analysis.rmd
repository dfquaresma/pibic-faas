---
title: "Garbage Collector Impact"
author: "David Ferreira Quaresma (david.quaresma@ccc.ufcg.edu.br)"
date: "dezembro, 2018"
output: html_document
---

```{r setup, include=FALSE}
require(dplyr)
```

# Introdução
Os resultados analisados neste documento foram obtidos através da execução de múltiplas chamadas de uma mesma função de modo sequencial, isto é, não concorrente. Para tal, utilizamos o script [curl-workload](https://github.com/dfquaresma/pibic-faas/blob/master/analysis/curl-workload/curl-workload.sh) para gerar carga e observar o impacto do coletor de lixo na função [business-logic-csv](https://github.com/dfquaresma/pibic-faas/blob/master/functions/business-logic/business-logic-csv/business-logic-csv/src/main/java/com/openfaas/function/Handler.java).   

# Setup
#### Gerais
- Execução utilizando ambiente default OpenFaaS.
- Utilização do of-watchdog (versão que aproveita a runtime).

#### Experimento
- Execução de 20.000 requisições.
- Execução sequencial das chamadas à função.

#### Função 
- Linguagem: java8
- Lógica de negócio: adiciona 2 ^ 21 (2097152) elemento em um array list.
- Contabiliza quantas coletas houveram durante a execução da lógica de negócio.
- Contabiliza a duração das coletas que aconteceram durante a execução da lógica de negócio.
- Contabiliza o tempo total de execução da lógica de negócio.

# Resultados
### Plot
```{r}
results = read.csv("../curl-workload/thumbnailator/r0.csv", header=T, dec=".")
plot(results$business_time.ms., results$scavenge_count + results$marksweep_count, xlab="tempo de execução (ms)", ylab="numero de coletas")
```


### Correlação Linear
```{r}
cor(results$business_time.ms., results$scavenge_count + results$marksweep_count)
cor(results$business_time.ms., results$scavenge_count)
cor(results$business_time.ms., results$marksweep_count)
```


### Quantiles
#### Não Ocorreu Coleta
```{r}
nocollect <- filter(results, scavenge_count + marksweep_count == 0)
quantile(nocollect$business_time.ms., c(.0, .25, .50, .75, .90, .99, .999))
```

#### Ocorreu Coleta
```{r}
withcollect <- filter(results, scavenge_count + marksweep_count > 0)
quantile(withcollect$business_time.ms., c(.0, .25, .50, .75, .90, .99, .999))
```


### Boxplot
```{r}
boxplot(nocollect$business_time.ms., withcollect$business_time.ms., names=c("Não Ocorreu Coleta", "Ocorreu Coleta"), main="Impacto do Coletor", outline=FALSE)
```


### Média, Variância e Desvio Padrão 
```{r}
meanNoCollect = mean(nocollect$business_time.ms.)
varNoCollect = var(nocollect$business_time.ms.)
sdNoCollect = sd(nocollect$business_time.ms.)

meanWithCollect = mean(withcollect$business_time.ms.)
varWithCollect = var(withcollect$business_time.ms.)
sdWithCollect = sd(withcollect$business_time.ms.)

data.frame(
  statistic = c("mean", "var", "sd"), 
  noCollect = c(meanNoCollect, varNoCollect, sdNoCollect), 
  withCollect = c(meanWithCollect, varWithCollect, sdWithCollect),
  comparison = c(meanWithCollect / meanNoCollect, varWithCollect / varNoCollect, sdWithCollect / sdNoCollect))
```